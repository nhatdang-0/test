<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chuy·ªÉn VƒÉn B·∫£n Th√†nh Gi·ªçng N√≥i - Nh·∫≠t ƒêƒÉng</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Comfortaa', cursive, sans-serif;
      background: linear-gradient(to top, #a8edea 0%, #fed6e3 100%);
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .scene {
      position: relative;
      width: 460px;
      min-height: 700px;
      background: #d7f0d9;
      border-radius: 30px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      padding: 40px 30px 100px 30px;
      overflow: hidden;
    }

    h1 {
      color: #2b5329;
      font-weight: 900;
      font-size: 24px;
      text-align: center;
      margin-bottom: 25px;
      text-shadow: 1px 1px 2px #a4d06f;
      position: relative;
      z-index: 2;
    }

    label {
      color: #3a6b35;
      font-size: 15px;
      font-weight: 600;
      display: block;
      margin: 15px 0 8px;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 18px;
      border: 2px solid #89b362;
      font-size: 16px;
      outline: none;
      font-family: 'Comfortaa', cursive, sans-serif;
      transition: border-color 0.3s ease;
    }

    textarea {
      height: 140px;
      resize: none;
    }

    input:focus, textarea:focus {
      border-color: #5a8b28;
    }

    button {
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 700;
      color: white;
      background: linear-gradient(90deg, #7ec850, #4a7f23);
      border: none;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(74, 127, 35, 0.5);
      font-family: 'Comfortaa', cursive;
    }

    button:hover {
      background: linear-gradient(90deg, #5a8b28, #3b5e18);
    }

    .tree, .cloud, .bush, .rabbit, .bird {
      position: absolute;
    }

    .cloud {
      top: 20px;
      left: -200px;
      width: 130px;
      height: 60px;
      background: #fff;
      border-radius: 50px;
      box-shadow: 30px 0 white, 60px 10px white, 90px 0 white;
      opacity: 0.85;
      animation: drift 60s linear infinite;
      z-index: 0;
    }

    @keyframes drift {
      0% { transform: translateX(0); }
      100% { transform: translateX(1200px); }
    }

    .corner-links {
      position: fixed;
      bottom: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      z-index: 999;
    }

    .corner-links a,
    .corner-links button {
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 20px;
      background: #fff;
      border: 2px solid #7ec850;
      color: #2b5329;
      font-weight: 700;
      text-decoration: none;
    }

    .top-left-controls {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .top-left-controls button {
      padding: 10px 12px;
    }

    #sharePopup {
      position: fixed;
      bottom: 70px;
      right: 20px;
      background: white;
      border: 2px solid #7ec850;
      border-radius: 12px;
      padding: 10px 15px;
      display: none;
      font-size: 14px;
      color: #2b5329;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 9999;
    }

    #sharePopup button {
      width: auto;
      margin-top: 10px;
      font-size: 14px;
      padding: 8px 12px;
    }
  </style>
</head>
<body>
  <audio autoplay loop>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_4e8703aef4.mp3" type="audio/mpeg">
  </audio>

  <div class="top-left-controls">
    <button onclick="speakNow()">üîä</button>
    <input type="range" min="0" max="1" step="0.01" value="1" id="volumeControl" title="√Çm l∆∞·ª£ng" />
  </div>

  <div class="scene">
    <h1>Chuy·ªÉn VƒÉn B·∫£n Th√†nh Gi·ªçng N√≥i - Nh·∫≠t ƒêƒÉng</h1>

    <label for="fileName">T√™n file:</label>
    <input type="text" id="fileName" placeholder="Nh·∫≠p t√™n file (kh√¥ng c√≥ ƒëu√¥i)..." />

    <label for="inputText">Nh·∫≠p vƒÉn b·∫£n:</label>
    <textarea id="inputText" placeholder="Nh·∫≠p vƒÉn b·∫£n v√†o ƒë√¢y..."></textarea>

    <button id="ttsBtn">Chuy·ªÉn vƒÉn b·∫£n th√†nh gi·ªçng n√≥i</button>
    <button id="downloadBtn">T·∫£i √¢m thanh</button>

    <div class="corner-links">
      <a href="https://nhatdang-0.github.io" target="_blank"><strong>Trang Ch·ªß</strong></a>
      <button id="shareBtn">üîó</button>
    </div>

    <div id="sharePopup">
      <div>Trang web:</div>
      <a href="https://nhatdang-0.github.io/chuyen-van-ban-thanh-giong-noi" target="_blank">https://nhatdang-0.github.io/...</a>
      <button onclick="copyLink()">Sao ch√©p li√™n k·∫øt</button>
    </div>

    <div class="tree" style="left: 20px;"></div>
    <div class="tree" style="right: 30px;"></div>
    <div class="bush" style="right: 80px;"></div>
    <div class="bush" style="left: 60px;"></div>
    <div class="rabbit" style="left: 140px;"></div>
    <div class="rabbit" style="right: 120px;"></div>
    <div class="cloud"></div>

    <footer class="footer">¬© 2025 Nh·∫≠t ƒêƒÉng. All rights reserved.</footer>
  </div>

  <script>
    const ttsBtn = document.getElementById('ttsBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const shareBtn = document.getElementById('shareBtn');
    const sharePopup = document.getElementById('sharePopup');
    const inputText = document.getElementById('inputText');
    const fileNameInput = document.getElementById('fileName');
    const volumeControl = document.getElementById('volumeControl');

    let utterance;

    const apiKey = '808e8232fd2b492db9681809734cc6de'; // API key VoiceRSS c·ªßa b·∫°n

    ttsBtn.addEventListener('click', () => {
      const text = inputText.value.trim();
      const fileName = fileNameInput.value.trim();
      if (!fileName || !text) {
        alert('Vui l√≤ng nh·∫≠p t√™n file v√† vƒÉn b·∫£n!');
        return;
      }
      speakNow();
    });

    function speakNow() {
      const text = inputText.value.trim();
      if (!text) return;
      if (utterance) speechSynthesis.cancel();
      utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'vi-VN';
      utterance.volume = parseFloat(volumeControl.value);
      speechSynthesis.speak(utterance);
    }

    volumeControl.addEventListener('input', () => {
      if (utterance) utterance.volume = parseFloat(volumeControl.value);
    });

    async function downloadMP3FromVoiceRSS(text, fileName) {
      if (!text || !fileName) {
        alert('Vui l√≤ng nh·∫≠p t√™n file v√† vƒÉn b·∫£n!');
        return;
      }

      const url = `https://api.voicerss.org/?key=${apiKey}&hl=vi-vn&c=MP3&f=48khz_16bit_stereo&src=${encodeURIComponent(text)}`;

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('L·ªói t·∫£i √¢m thanh');

        const blob = await response.blob();
        const audioUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = audioUrl;
        a.download = `${fileName}.mp3`;
        a.click();
      } catch (err) {
        alert('Kh√¥ng th·ªÉ t·∫°o file √¢m thanh. Vui l√≤ng th·ª≠ l·∫°i!');
        console.error(err);
      }
    }

    downloadBtn.addEventListener('click', () => {
      const fileName = fileNameInput.value.trim();
      const text = inputText.value.trim();
      downloadMP3FromVoiceRSS(text, fileName);
    });

    shareBtn.addEventListener('click', () => {
      sharePopup.style.display = sharePopup.style.display === 'block' ? 'none' : 'block';
    });

    function copyLink() {
      const url = 'https://nhatdang-0.github.io/chuyen-van-ban-thanh-giong-noi';
      navigator.clipboard.writeText(url).then(() => {
        alert('Li√™n k·∫øt ƒë√£ ƒë∆∞·ª£c sao ch√©p!');
      });
    }
  </script>
</body>
</html>
